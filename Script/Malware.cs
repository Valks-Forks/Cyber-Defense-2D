using Godot;
using System;

public partial class Malware : CharacterBody2D
{
	public const float Speed = 30.0f;
	public int Health = 30;

	public override void _PhysicsProcess(double delta)
	{
		var parentNode = GetParent() as PathFollow2D;
		if (parentNode != null)
		{
			parentNode.Progress += Speed * (float)delta;
			
			var path = parentNode.GetParent() as Path2D;
			if (path != null) 
			{
				if (parentNode.Progress >= path.Curve.GetBakedLength()) 
				{
					GameManager.Instance.ReduceHealth(1);
					QueueFree();
				}	
				
				if (Health <= 0) 
				{
					GameManager.Instance.AddCoins(5);
					QueueFree();
				}								
			}
		}
	}
}
